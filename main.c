#include "get_next_line.h"
#include <fcntl.h>
#include <stdio.h>
#include <string.h>

void	expect_str(char *str1, char *str2)
{
	if (str1 == NULL && BUFFER_SIZE <= 0)
	{
		printf("str is NULL. Because BUFFER_SIZE less than zero\n");
		return ;
	}
	if (strcmp(str1, str2) == 0)
	{
		printf("OK\n");
	}
	else
	{
		printf("KO\n");
	}
}

void	expect_null(char *str)
{
	if (str == NULL)
	{
		printf("OK\n");
	}
	else
	{
		printf("KO\n");
	}
}

void test_no_nl()
{
	int fd = open("files/no_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	// char *str2 = get_next_line(fd);	
	expect_str(str1, "01234567890123456789012345678901234567890");
	// expect_null(str2);
	free(str1);
	// free(str2);
	close(fd);
}

void test_nl()
{
	int fd = open("files/nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	expect_str(str1, "\n");
	expect_null(str2);
	free(str1);
	free(str2);
	close(fd);
}

void test_empty()
{
	int fd = open("files/empty", O_RDONLY);
	char *str1 = get_next_line(fd);	
	expect_null(str1);
	close(fd);
}

void test_with_nl()
{
	int fd = open("files/with_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	char *str3 = get_next_line(fd);
	expect_str(str1, "0123456789012345678901234567890123456789\n");
	expect_str(str2, "0");
	expect_null(str3);
	free(str1);
	free(str2);
	close(fd);
}
void test_multiple_line_no_nl()
{
	int fd = open("files/multiple_line_no_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	char *str3 = get_next_line(fd);
	char *str4 = get_next_line(fd);
	char *str5 = get_next_line(fd);
	char *str6 = get_next_line(fd);

	expect_str(str1, "01234567890123456789012345678901234567890\n");
	expect_str(str2, "987654321098765432109876543210987654321098\n");
	expect_str(str3, "0123456789012345678901234567890123456789012\n");
	expect_str(str4, "987654321098765432109876543210987654321098\n");
	expect_str(str5, "01234567890123456789012345678901234567890");
	expect_null(str6);
	free(str1);
	free(str2);
	free(str3);
	free(str4);
	free(str5);
	close(fd);
}

void test_multiple_line_with_nl()
{
	int fd = open("files/multiple_line_with_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	char *str3 = get_next_line(fd);
	char *str4 = get_next_line(fd);
	char *str5 = get_next_line(fd);
	char *str6 = get_next_line(fd);

	expect_str(str1, "9876543210987654321098765432109876543210\n");
	expect_str(str2, "01234567890123456789012345678901234567890\n");
	expect_str(str3, "987654321098765432109876543210987654321098\n");
	expect_str(str4, "01234567890123456789012345678901234567890\n");
	expect_str(str5, "9876543210987654321098765432109876543210\n");
	expect_null(str6);
	free(str1);
	free(str2);
	free(str3);
	free(str4);
	free(str5);
	close(fd);
}

void test_mutiple_line_and_nl_eof_nl()
{
	int fd = open("files/mutiple_line_and_nl_eof_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	char *str3 = get_next_line(fd);
	char *str4 = get_next_line(fd);
	char *str5 = get_next_line(fd);
	char *str6 = get_next_line(fd);
	char *str7 = get_next_line(fd);
	char *str8 = get_next_line(fd);
	char *str9 = get_next_line(fd);
	char *str10 = get_next_line(fd);

	expect_str(str1, "01234567890123456789012345678901234567890\n");
	expect_str(str2, "\n");
	expect_str(str3, "987654321098765432109876543210987654321090\n");
	expect_str(str4, "\n");
	expect_str(str5, "0123456789012345678901234567890123456789012\n");
	expect_str(str6, "\n");
	expect_str(str7, "987654321098765432109876543210987654321090\n");
	expect_str(str8, "\n");
	expect_str(str9, "01234567890123456789012345678901234567890\n");
	expect_null(str10);
	free(str1);
	free(str2);
	free(str3);
	free(str4);
	free(str5);
	free(str6);
	free(str7);
	free(str8);
	free(str9);
	close(fd);
}

void test_big_line_with_nl()
{
	int fd = open("files/big_line_with_nl", O_RDONLY);
	char *str1 = get_next_line(fd);
	char *str2 = get_next_line(fd);
	expect_str(str1, "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678\n");
	expect_null(str2);
	free(str1);
	close(fd);
}

int main()
{
	printf("--------------------------------\n");
	test_no_nl();
	// test_nl();
	// test_empty();
	// test_with_nl();
	// test_multiple_line_no_nl();
	// test_multiple_line_with_nl();
	// test_mutiple_line_and_nl_eof_nl();
	// test_big_line_with_nl();
	printf("--------------------------------\n");
	system("leaks -fullContent -groupByType a.out");
	return (0);
}
